---
title: "Исследование"
author: "Юношева Виктория"
date: September 11, 2022
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = F,
	fig.width = 10,
	message = FALSE,
	warning = FALSE,
	dpi = 100
)
```

# Гиппотезы-вопросы :

Гипотезы для проверки:

1.	Количество постоянных сотрудников в магазине влияет на % выполнения плана.

Да, с увеличением постоянных сотрудников % выполнения плана снижается. Тогда как при стабильном покрытии в магазине (~>=0,8) процент покрытия увеличивается.Оптимальное количество постоянных сотрудников магазина для выполнения плана и стабильности покрытия -4 для общей сети и 3 для Санкт-Петербурга и Москвы.

2.	В среднем увеличение количества постоянных сотрудников ведет к увеличению выполнения плана.(при подтверждении 1 гипотезы).

Нет, наоборот - снижает.

3.	Процент покрытия в магазине влияет на процент выполнения плана

Нет не влиет- более того, процент выполнения плана у магазинов с низким и высоким покрытием примерно одинаково для всех акций.

4.	Процент покрытия не влияет на % выполнения плана.

 Да, не влияет.
 
5.	Город значимо влияет на % выполнения плана. (через план и фактическую продажу).

Да, город имеет влияение, но это связано с проходимостью в магазинах и их местоположением, так такие города как Заполярный или Кострома имеют  значимые отличия от МСК или СПБ.Поэтому их сравнение в контексте заимосвязей может сделать результаты нерелевантными.

6.	При стабильном покрытии (разница между максимальным и минимальным покрытием не более 10 процентов) среднее выполнение плана выше, чем в тех, где наблюдаются перепады.

Нет, не верно.

7.	Отчего зависит процент выполнения плана?

От количества постоянных сотрудников, % выполнения по другим акциям, от среднего чека покупателя (для VALORI) и доли бренда в категории.




# Покрытие заявок и "стабильность коллектива"

```{r}
library(readxl)
library(dplyr)

library(ggplot2)

Investigation <- read_excel("Investigation.xlsx", 
    sheet = "Investigation")
investigate=Investigation %>% filter(Покрытие <=0.8)
f=ggplot(investigate,aes(мес,Покрытие,fill=as.factor(Город),color=Магазин))+geom_col(position = "dodge")+ theme(legend.position="none")+labs(title="Магазины с покрытием ниже 80 % по месяцам и Городам",  x ="Месяцы", y = "% покрытия")
library(plotly)
ggplotly(f)
```

Количество проблемных магазинов увеличилось с марта по август вдвое.

При этом колебание покрытие заявок в магазине уменьшается с увеличением постоянных сотрудников. Причем колебания существенно сокращаюся при наличии от 4 постоянных работников в одном магазине.

```{r message=FALSE, warning=FALSE}
f1=ggplot(Investigation,aes(мес,Покрытие,group=Город,color=Город))+geom_line(position = "dodge")+facet_grid(. ~ Investigation$`Кол-во сотрудников`)+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+theme(legend.position="none")+labs(title="Динамика покрытия заявок магазинов в зависимости от\nкол-ва постоянных ПК",  x ="Месяцы", y = "% покрытия")
ggplotly(f1)
inv=Investigation %>% filter(Город=="Санкт-Петербург" |Город=="Москва")
f2=ggplot(inv,aes(мес,Покрытие,group=Город,color=Город))+geom_line(position = "dodge")+facet_grid(. ~ inv$`Кол-во сотрудников`)+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(title="Динамика покрытия заявок магазинов в зависимости от\nкол-ва постоянных ПК в Москве и Питере",  x ="Месяцы", y = "% покрытия")
ggplotly(f2)
```

Покрытие и процент выполнения плана по акциям: при увеличении покрытия в магазинах - процент выполнения плана увеличивается, однако  такая взаимосвязь весьма слаба и может зависеть от других показателей.Тогда как количество постоянных сотрудников даже при стабильно высоком покрытии магазинов не увеличивает % выполнения плана ни по Valori, ни по WEIS.

```{r}
ggplot(Investigation,aes(Покрытие,`VALOROI % выполнения плана по выручке`,fill=Магазин))+geom_line(position = "dodge")+ theme(legend.position="none")+labs(title="Зависимость покрытия от % выполнения планы выручки по VALORI",y="% Выполнения плана")+facet_grid(. ~ Investigation$`Кол-во сотрудников`)

ggplot(Investigation,aes(Покрытие,`WEIS процент`,fill=Магазин))+geom_line(position = "dodge")+ theme(legend.position="none")+labs(title="Зависимость покрытия от % выполнения планы выручки по WEIS",y="% Выполнения плана")+facet_grid(. ~ Investigation$`Кол-во сотрудников`)

```


Тесты :

Существует ли статистически значимая связь между % выполнения плана и покрытием заявок?

Для проведения теста мы разделим магазины на две группы по покрытию заявок (для формирования полной картины будем варировать группы в соотношении  полноты покрытия 1 тест - более 90% , 2 группа - более 80% , 3 тест более 70%, 4 тест - более 60% ). Таким образом мы проверим - есть ли статистическая разница и связь между выполнением плана и покрытием.

Вывод: покрытие не влияет значимо на процент выполнения плана. Нет значимой разницы между группами с высоким (более 50%), среднем ( от 20% до 50%) и низким (до 20%) выполнением плана и покрытием магазина. Распределение примерно равное между магазинами с высоким покрытием по выполнениюплана и низким покрытием.

```{r}
library(stats)

```




```{r}
invest=Investigation  %>% mutate(cover=dplyr::case_when(Покрытие>=1 ~"Высокое покрытие" , T~ "Низкое покрытие"))
invest=invest  %>% mutate(plan=case_when(`VALOROI % выполнения плана по выручке`<=0.2 ~"Низкое выполнение",`VALOROI % выполнения плана по выручке`>0.2 & `VALOROI % выполнения плана по выручке`<=0.5  ~ "Среднее выполнение" , T~ "Высокое выполнение"))
df=table(invest$plan, invest$cover)
fisher.test(df)
mosaicplot(df, color = TRUE) 
```

```{r}
invest2=Investigation  %>% mutate(cover=dplyr::case_when(Покрытие>=1 ~"Высокое покрытие" , T~ "Низкое покрытие"))
invest2=invest2  %>% mutate(plan=case_when(`WEIS процент`<=0.2 ~"Низкое выполнение",`WEIS процент`>0.2 & `WEIS процент`<=0.5  ~ "Среднее выполнение" , T~ "Высокое выполнение"))
df=table(invest2$plan, invest2$cover)
fisher.test(df)
mosaicplot(df, color = TRUE) 

```

## Исследование влияния города.

```{r}
ii=Investigation %>% filter(`VALOROI % выполнения плана по выручке`>=1)
u=ggplot(ii,aes(x=Город,`VALOROI % выполнения плана по выручке`,fill=ii$Город))+geom_col(position="dodge")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(title="Города с высоким выполнением плана по vALORI")
ggplotly(u)
```

```{r}
ii=Investigation %>% dplyr::filter(`WEIS процент`>=1)
u=ggplot(ii,aes(x=Город,`WEIS процент`,fill=ii$Город))+geom_col(position="dodge")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(title="Города с высоким выполнением плана по WEIS")
ggplotly(u)

```

Нет корреляции

```{r}
library(psych)
Investig=Investigation %>% select (Покрытие,`VALOROI % выполнения плана по выручке`,`Кол-во сотрудников`,`Выполнение плана в штуках`,`Доля бренда в категории`)
corPlot(Investig, histogram = TRUE, method = "pearson")
```

# Регрессионный анализ

Отчего зависит количество активированных купонов, процент выполнения плана  и покрытие?

Выявлена значимая связь между месяцем и покрытием в магазинах.Не выявлено связи между покрытием и % выполнения пдлана, что подстверждает наши прежние выводы.

```{r}
linearMod <- lm(Покрытие~.-ТМ-Магазин-Город, data=Investigation)
linearMod   
```

Существует значимое влияние выполнения плана по VALORI в зависимости от  количества постоянных сотрудников, количества актирвированных купонов и выполненя плана по другим акциям.То есть магазины с высоким выполнениям акции по одному товару - будут лучше его выполнять и по-другим.Средний чек также имеет влияние на % выполнения плана. Тоже верно и для WEIS.

```{r}
linearMod <- lm(`VALOROI % выполнения плана по выручке`~.-ТМ-Магазин-Город, data=Investigation)
summary(linearMod) 
```

Для продукции WEIS

```{r}
linearMod <- lm(`WEIS процент`~.-ТМ-Магазин-Город, data=Investigation)
linearMod
```


# Вывод


1) Покрытие не влияет на выполнение плана.

2) Стабильность коллектива снижает % выполнения плана после 4 сотрудников (для сети) и после 3 постоянных сотрудников для СПБ и Москвы.

3) Магазины с высоким % выполнения плана склонны также хорошо выполнять и другие акции. Этот вывод можно объяснить хорошей проходимостью в магазине, количеством активированных купонов и долей товаров из акции в чеке.

4) Средний чек имеет значимое влияние на выполнения плана акций.

5) Город имеет влияние на % выполнения плана, но некорректно включать его в регрессионный анализ, так как влияние любого магазина оценивается относительно другого, а такие данные могут дать смещенный результат по другим параметрам.Но в целом магазины в СПБ и Москве значимо не различаются по влияющим факторам, перечисленным в пункте 3 и 4 при прогнозировании % выполнения акции.


















